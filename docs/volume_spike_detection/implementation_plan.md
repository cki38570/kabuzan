# 出来高急増（Volume Spike）検知機能の実装計画

株価が大きく動く前の「初動」を出来高の変動から捉え、AIの投資判断の精度を向上させるとともに、ユーザーが直感的にチャンスを認識できるUIを実装します。

## 実施内容

### 1. ロジック実装 (`modules/analysis.py`)
- **新関数**: `detect_volume_spike(df, window=20, threshold=2.0)`
    - 直近20日間（または5日間）の出来高平均（Moving Average）を算出。
    - 最新の出来高が平均の「2倍（2.0）」以上の場合、急増と判定します。
- **統合**: `calculate_trading_strategy` の戻り値 `strategic_data` に `volume_spike`（bool）と `volume_ratio`（倍率）を追加します。

### 2. AI分析の強化 (`modules/llm.py`)
- **プロンプト更新**: Gemini に渡すコンテキストに出来高情報を追加。
    - 「現在の出来高は過去20日平均の N 倍であり、需給が急激に変化しています」という情報を付与。
- **分析深度**: 株価の上昇/下落が出来高を伴っているかどうかをAIに評価させ、結論の信頼性を高めます。

### 3. UI/UXの構築 (`app.py`)
- **サマリーダッシュボード**: 
    - AI判定のすぐ隣に、検知時のみ **「🔥 出来高急増！」** というバッジを動的に表示します。
    - デザインは現在の「ガラスモーフィズム 2.0」に合わせ、グラデーションとブラー効果を活かしたものにします。

## 検証計画
### 自動テスト・検証
- `verify_volume_logic.py` を作成（または既存の検証スクリプトを拡張）し、出来高急増が期待通り検知されるか確認。
- Gemini API のレスポンスに含まれる「出来高」に関する言及をチェック。

### 手動確認
- ブラウザで実際に出来高が急増している銘柄を入力し、ダッシュボードにバッジが表示されるか、AIの結論が変化するかを確認。

> [!IMPORTANT]
> 出来高は流動性の低い銘柄ではノイズになりやすいため、AIには時価総額や市場全体の動向も併せて考慮させるように調整します。
