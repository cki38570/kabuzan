# アプリ評価・AI分析信頼性調査レポート

本アプリケーション「カブザン」のAI分析機能について、内部ロジックの調査に基づいた評価を報告します。

## 1. AI分析の信頼性 (Reliability): ★★★★☆ (高)

分析の「仕組み」は、一般的な株アプリよりも遥かに高度です。
- **ヘッジファンド方式の採用**: 内部的に「テクニカル」「需給」「ファンダ」の3名の専門家AIをシミュレートし、さらに「強気派」「弱気派」による論理バトル（自己反省プロセス）を経て結論を出しています。これにより、AI特有の「一方向への思い込み」を抑制しています。
- **データ・フォールバック**: FMP、yfinance、DefeatBetaの3箇所からデータを取得しており、特定のサービスが停止しても分析を継続できる頑健性があります。

## 2. 分析の正確性 (Accuracy): ★★★★☆ (中高)

計算ロジック自体は極めて正確ですが、以下の点に留意が必要です。
- **定量的根拠の重視**: プロンプトで「抽象的な表現を禁止」し、「RSIがXXであるため」といった数値に基づいた回答を強制しています。これにより、ハルシネーション（嘘）の発生率を低く抑えています。
- **リスク管理の高度化**: ATR（真の変動幅）に基づいた動的な損切りラインの設定など、プロの投資手法が組み込まれています。
- **留意点**: バックテストロジックにおいて、現在の戦略数値を過去30日に適用してシミュレートしているため、実績値が少し「出来すぎ（楽観的）」に見える傾向があります。

## 3. 総評
このアプリは、単にAIに聞くだけでなく、**「信頼できるテクニカル指標をAIに食わせ、かつ批判的な視点を持たせる」**という設計がなされており、個人投資家の意思決定サポートツールとして非常に高い完成度にあります。

## 推奨される使用方法
AIの出す「Total Score」や「結論」だけを見るのではなく、AIが提示している**「弱気派の意見 (Bear View)」**を必ず確認してください。そこに、現在のテクニカル指標が隠している潜在的なリスクが言語化されています。

## 4. バグ修正と検証状況

本日の開発において、以下の重大なバグ修正を実施しました。

### 修正内容
1.  **Home画面でのエラー (`UnboundLocalError: dm`)**
    *   **原因**: データマネージャー (`dm`) の初期化スコープが適切でなく、キャッシュ利用時などに未定義のまま参照されていた。
    *   **対策**: `render_home` 関数の冒頭で `dm` を初期化し、常に利用可能な状態を保証。

2.  **クイックスキャンのエラー (`KeyError`)**
    *   **原因**: スキャン結果のDataFrameに必要な列が含まれていない場合に、強制的に列指定を行っていたためクラッシュしていた。
    *   **対策**: `available_cols` を動的に生成し、存在する列のみを表示するように修正。

3.  **AI分析の信頼度スコア表示**
    *   **原因**: AIからのJSONレスポンスのキー (`confidence`) の揺らぎに対応できていなかった。
    *   **対策**: `confidence`, `confidence_score` などの表記ゆれを吸収するロジックを追加。

### 検証ステータス
現在、本番環境 (Streamlit Cloud) へのデプロイと最終確認を行っています。
