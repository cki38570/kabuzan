# AI分析の高度化と表示不具合の解消計画

## 1. 背景と目的
「kabuzan」のAI分析において、より詳細で根拠に基づいたレポートを生成することを目指します。また、開発過程で発生した本番環境での分析エラー（404/429）およびチャート表示の不備を解消します。

## 2. 実装計画の詳細

### 2.1 AI分析の高度化 (llm.py)
- **仮想投資戦略会議フロー**: テクニカル、需給、ファンダメンタルの3名の専門家による独立した分析をシミュレート。
- **証拠に基づく理由付け**: Bull/Bearビューにおいて、具体的な数値を3つ以上含めることをプロンプトで強制。
- **出力の詳細化**: 各解説セクションで200〜300文字程度の記述を要求。

### 2.2 安定性の向上
- **モデル優先順位の変更**: 404エラーが発生したモデルを回避し、動作実績のある `gemini-2.0-flash-exp` を優先。
- **レート制限対策**: 指数関数的バックオフによるリトライ処理を強化。

### 2.3 チャート表示の修正 (charts.py / data_manager.py)
- **カラム名同期**: `pandas-ta` が出力するカラム名（`SMA_5` 等）と `charts.py` の参照名を一致させる。
- **データフローの改善**: `get_technical_indicators` が計算済みの指標を含むDataFrameを返すように修正。

## 3. 検証プラン
- ローカル環境でのStreamlit起動と動作確認。
- 実際の銘柄（6758等）でのAI分析生成とSMA/BB表示の目視確認。
