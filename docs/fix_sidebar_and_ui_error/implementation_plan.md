# 実装計画 - サイドバーのインデント修正とUIの堅牢化

サイドバーの `add_ticker_form` ブロック内にウォッチリストの描画ロジックが誤って含まれているため、`st.button` がフォーム内で使用できないというエラー（`StreamlitAPIException`）が発生しています。また、銘柄情報の取得に失敗した場合の数値処理を強化します。

## ユーザーレビューが必要な項目

> [!IMPORTANT]
> この修正により、サイドバーの「リストをクリア」ボタンが正しく機能するようになります。また、銘柄データ取得中の表示がより安定します。

## 提案される変更

### [Component: UI & Logic]

#### [MODIFY] [app.py](file:///c:/Users/GORO/Desktop/kabuzan/app.py)
- `st.form("add_ticker_form")` ブロックの終端を正しく設定し、以降の「キャッシュ初期化」「銘柄情報取得関数の定義」「カード描画ループ」「リストをクリアボタン」をフォームの外（ただし `st.sidebar` の中）に移動します。
- `get_cached_card_info` 関数内で、`t.fast_info` から取得する `curr` と `prev` のデフォルト値を `0` または直前の終値として確実に保持するようにし、`None` による計算エラーを防ぎます。

## 検証計画

### 手動検証（ブラウザツールを使用）
1. [本番環境](https://kabuzan-ai.streamlit.app/) にアクセスし、エラーが表示されないことを確認。
2. サイドバーから銘柄（例：7203）を追加し、トースト通知とウォッチリストへの反映を確認。
3. 「リストをクリア」ボタンをクリックし、正常にリセットされるか確認。
4. 銘柄カードをクリックし、メイン画面の「AI分析」が正常に表示されるか確認。
