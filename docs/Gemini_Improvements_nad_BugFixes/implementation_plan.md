# 実装計画: Geminiからの改善提案の反映

## 概要
Geminiから提案された、コードの堅牢性、パフォーマンス、UI/UXに関する改善案を実装します。これにより、エラーの減少、アプリの高速化、使い勝手の向上が期待されます。

## ユーザーレビューが必要な項目
- 特になし（提案内容に準拠）

## 変更内容

### 1. `modules/analysis.py` の改修
*   **目的**: テクニカル指標の計算とデータチェックを堅牢にする。
*   **変更点**:
    *   **カラム名の統一**: `pandas_ta` が生成するカラム名（`SMA_5`, `BBU_20_2.0` など）を明示的にリネームし、`SMA5`, `BB_Upper` などの一貫した名前に統一する。
    *   **インポートの移動**: `import pandas_ta as ta` をファイルの一番上に移動。
    *   **データ不足時の柔軟性**: `calculate_trading_strategy` 内の `any(...)` チェックを緩和し、一部の指標（長期SMAなど）が欠けていても分析を続行できるようにする。

### 2. キャッシュ戦略の最適化 (`modules/data.py`, `app.py`)
*   **目的**: APIコスト削減とアプリの高速化。
*   **変更点**:
    *   **AI分析のキャッシュ**: `generate_gemini_analysis` の結果を `st.session_state` または `st.cache_data` に保存し、同一銘柄・同一条件での再実行を防ぐ。
    *   **ウォッチリストの高速化**: `get_cached_card_info` で重い `t.info` の使用をやめ、`t.fast_info` や `t.history` を利用して軽量化する。

### 3. UI/UX の改善 (`app.py`)
*   **目的**: モバイル対応と見た目の向上。
*   **変更点**:
    *   **タブのアイコン化**: `st.tabs` のラベルに絵文字アイコン（📈, 🤖, 📊）を追加し、視認性を高める。

## 検証計画
### 自動テスト
- 修正後の `modules/analysis.py` が正しいカラム名を持つDataFrameを返すか確認。
- 新規上場銘柄（データ不足）でもエラー落ちしないか確認。

### 手動検証
- アプリを起動し、チャートとAI分析が表示されるか確認。
- ウォッチリストの読み込み速度が体感で向上しているか確認。
- タブ切り替えやリロード時にAI分析が再実行されていないか（ログ等で）確認。
